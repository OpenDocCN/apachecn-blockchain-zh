# 在区块链平台上从事商业案例

前一章探讨了Hyperledger的体系结构，并向您展示了如何组装一个基于Hyperledger的业务网络示例。它解释了以创始人为基础和以财团为基础的商业网络。它举例说明了业务网络组件、向渠道添加对等点，以及使用链码和智能合同。它还涵盖了身份、安全性、隐私、会员服务、渠道、分类帐和交易流。在这一章中，我们将学习如何根据**甲骨文区块链平台** ( **OBP** )的构造来设计解决方案。本章有两个部分:第一部分着重于定义一个围绕证书颁发的用例，并在区块链网络上与可信方共享证书。第二部分涵盖了**区块链即服务** ( **BaaS** )平台，该平台为实现区块链技术的潜力提供了一个有效、高效和经济的途径。

BaaS是区块链采用的催化剂。BaaS提供商确保您的区块链网络的安装和维护，让您的企业和IT专注于chaincode和dApps。整个区块链生态系统将由云服务提供商管理、维护和支持。许多顶级供应商，如甲骨文，都有面向BaaS的托管**平台即服务** ( **PaaS** )产品，因为BaaS允许客户采用他们的SaaS、**业务流程管理** ( **BPM** )流程、定制应用程序等，以经济高效的方式利用区块链的力量。本章还通过探索教育行业的一个用例来探究Oracle的BaaS，向您展示使用区块链平台的简易性。

# 了解业务场景

教育是人类社会的基石。这也有助于根据时代变化的需要，不断提高员工在新知识领域的技能。尽管是最古老的行业之一，但它仍然受到效率低下的困扰:

*   多个手动流程导致管理延迟
*   管理延迟导致验证延迟
*   手动过程总是会对学生证书的真实性产生一些怀疑

为了构建一个在OBP上实现的解决方案，我们在该业务流程中选择了一个场景来处理资格证书的审批，以安全的方式将证书颁发给学生，并以可信的方式与其他利益相关方(如雇主和其他教育机构)共享证书。

# 用例介绍

用例包括与个人教育证书/资格的生命周期相关的交互和流程流的典型设置。在本书中，我们将考虑涉及以下场景的用例的各个方面:

*   主管当局签发/批准证书
*   证书对所有者(即学生)的可用性
*   由雇主或其他教育机构等第三方验证证书

在现实生活中，有太多的利益相关者参与其中，如特定的学校、考试负责人、考试机构、学生、其他机构和雇主。为简单起见，我们将考虑以下利益相关方:

*   **甲骨文红学** ( **ORS** ):制证人(学部)
*   **甲骨文帝国大学** ( **OEU** ):证书审批者和颁发者(大学)
*   **学生、雇主、其他大学**:证书查看者/验证者

让我们快速看一下这个用例中现有的真实流程:

![](assets/063e4b9c-52ae-43d9-87ee-391be2dbe37e.png)

证书创建、批准、颁发和审查流程

现有工艺存在以下低效之处:

*   手动验证过程使其速度很慢
*   核实过程在确定欺诈性索赔方面速度缓慢
*   它需要外部背景验证服务
*   纸质证书容易丢失或损坏
*   伪造纸质证书和验证过程中的漏洞使证书的可信度受到质疑

# 用例鉴定的标准

在为我们的业务场景提出一个基于区块链的解决方案之前，让我们先评估一下它是否适合区块链的解决方案。我们如何确定一个用例的基于区块链的解决方案的应用将真正解决当前过程面临的挑战？

让我们思考一下区块链技术可以克服的用例的一些特征和约束。以下考虑因素并不详尽；相反，这是一种尝试提出区块链解决方案的指示性方法。

以下是区块链技术可以克服的用例的一些特征和限制:

*   可以用集中式解决方案解决用例吗？与纯手动流程(如果存在)相比，由OEU管理的集中式解决方案将在某些方面加快速度，但它会带来其他挑战，而无法提供克服所有现有低效问题的解决方案。集中式解决方案的挑战如下:
    *   集中式解决方案不能保证ORS和OEU业务流程的协同增效。因此，离线和在线过程之间的断开不会在系统效率方面提供太多的改进。
    *   从系统或信任的角度来看，会有单点故障。
    *   它要求其他各方信任一个单一的实体(OEU ),而无需其他利益攸关方的认可或授权。
    *   它并没有提供一个有效的解决方案来对付假证书的发行。

*   是否存在多个利益相关方共享的数字资产？考虑到教育证书是这个用例中的数字资产，它确实将在ORS和OEU之间共享，用于生成、处理、授予和验证。
*   数字资产是否需要以安全的方式存储和访问？由于证书是共享资产，将由不同的利益相关者访问，因此安全机制至关重要。考虑到资产的性质，安全性对于以下方面非常重要:
    *   任何对它的访问都应该被适当地跟踪
    *   对证书数据的任何更新都应得到ORS和OEU的认可
    *   证书应受到保护，以防任何类型的篡改和未经授权的访问
*   用例中潜在涉及的组织之间有信任问题吗？需要的是在ORS、OEU和证书查看者之间建立信任。用例的解决方案应该确保通过设计自动建立信任。

# 区块链解决方案的优势

用例需要一个数字资产(教育证书),该资产应在利益相关方之间共享，并表现出以下特征:

*   共享资产状态
*   相互认可和验证的数据工作流
*   对所有授权利益相关者透明而安全的访问
*   未经修改的、永久的存在证明和认可证明

考虑到解决方案所需的特征，基于区块链的解决方案是合适的选择。凭借其对不变性、共享分类帐、安全访问和交易背书属性的内在支持，基于区块链的解决方案将能够满足所有用例需求。此外，通过让更多的利益攸关方参与进来和应用智能合同，这将为进一步自动化和流程效率开辟可能性。

对于我们的使用情形，基于区块链的解决方案将实现以下主要优势:

*   一个可信、防篡改的教育证书数字存储库
*   消除丢失或损坏的风险
*   简化(几乎实时)的验证过程，因为教育证书保存在经过适当授权的可信、不可变的共享分类账上

进一步的可能性如下:

*   个人的大规模、协作、完整的教育证书历史
*   使用这样的真实来源作为任何进一步批准的先决条件，如研究资助和工业合作
*   将教育资格标记为通用的、行业认可的表示形式(例如，EduCoin)

# 设计解决方案

既然我们已经确定了基于区块链的解决方案的用例，让我们开始设计符合OBP架构的解决方案。

设计过程没有固定的步骤顺序。这取决于解决方案设计者的判断。主要目标应该是明确OBP解决方案的各个方面，从逻辑角度到部署方面。

# 业务网络拓扑

正如我们之前提到的，对于我们的用例，我们考虑三个利益相关者。他们是OEU、ORS和**证书查看者** / **验证者**(姑且把这个缩写为 **CVs** )。我们需要根据每个利益相关者的职能来确定他们的角色:

*   OEU是不同学校(学院)所属的大学或管理机构。正是这个实体拥有批准学校提交的学生教育证书的最终权力。
*   ORS是学生注册并完成学业的学校之一。完成后，ORS将评估并提交学生的教育证书给OEU。在更大的背景下，ORS可以被归类为一个代表性的区块链实体的一部分，这个实体被称为学校。这取决于业务需求和实现环境。
*   学生、雇主和职业介绍所等简历主要是数据(教育证书)的消费者，因此对网络具有只读访问权限。

基于这一前提，下表提供了对实体的描述:

| **组织** | **实体类型** | **访问类型** |
| 娱乐城 | 创始人 | 读/写 |
| 经口补液盐 | 认可参与者 | 读/写 |
| CVs | 参与者 | 阅读 |

# 渠道协会

在我们的用例中，单一类型的资产将与所有涉众共享，即证书数据。这使得每个人都必须能够访问相同的分类账数据。因此，它将是一个单通道网络组织，其中所有利益相关者将与各种访问角色相关联，如前所列。

下图描述了如何为解决方案创建OBP节点的逻辑视图:

![](assets/62bdecb4-ac91-4c3f-b0ff-8b3e213344cb.png)

网络拓扑和通道关联

此图显示了不同利益相关者与单一渠道的关联。

# 网络产物

在确定了网络拓扑和利益相关者之后，让我们定义共享资产和将通过网络在其上执行的操作。

# 资产模型

对于给定的用例，我们主要有两种类型的对象存储在分类帐中:

*   **学生** ( **接收者**):基本信息
*   **证书**:证书数据

下图从较高的层面描述了资产结构及其之间的关系:

![](assets/5c064f83-b9d4-4713-b92f-646a1ff2a7ba.png)

资产模型

# 链码交易

用例要求利益相关方在证书生命周期的不同阶段执行以下事务:

| **交易** | **演员** | **描述** |
| `CreateReceiver` | 经口补液盐 | 创建新的接收者或学生 |
| `AddCertificate` | 经口补液盐 | 为接收者插入证书 |
| `ApproveCertificate` | 娱乐城 | 批准证书 |
| **搜索操作** |  |  |
| `QueryByCert_id` | 全部 | 查询证书 |
| `QueryByRecev_id` | 全部 | 按ID查询接收方 |
| `GetCertificateHistory` | OEU/ORS/接收器 | 记录的一个键的查询历史 |
| `QueryAllCerts` | OEU/ORS(眼睛/耳朵) | 查询所有学生的所有证书 |

# 解决方案操作流程

到目前为止，我们已经确定了OBP的利益相关者、他们的关联、分类帐数据模型和链码事务。本节将帮助您了解基于OBP的解决方案可以对现有业务流程带来的变化，从而克服当前面临的低效率和挑战。

下图显示了合格用例的解决方案流程:

![](assets/86a763d2-2668-4e95-b4ed-71a8a936b2b6.png)

溶液流动

# 解决方案架构

作为解决方案架构的一部分，本节涵盖了基于OBP的解决方案、其组件和实例的整体高级组件视图和运行时部署视图。

# 高层架构

让我们确定实施基于OBP的解决方案所需的解决方案组件以及组件之间的交互。下图描述了高级解决方案架构:

![](assets/b0967741-56ed-4487-81b0-9c1fe762fa7b.png)

解决方案架构-高级别

这些是该解决方案的组件:

*   **OBP仪表板**为OEU和ORS的管理员/操作员提供了一个执行OBP管理和配置任务的界面。
*   每个涉众都需要不同的客户端应用程序集:
    *   以外:
        *   创建学生条目并在分类帐中插入学生的证书数据
        *   为了能够搜索学生和证书数据
    *   **欧乌**:
        *   为了能够搜索学生和证书数据
        *   批准/拒绝学生的证书数据
    *   **学生** ( **简历**):
        *   能够查看他们批准的证书
        *   为证书验证者生成一个令牌，以验证他们存储在OBP分类帐中的学历证书
    *   **证书验证者**:
        *   为了能够使用学生使用OBP解决方案生成的令牌来验证学生的学术证书

# 部署架构

下图描述了OBP的所有部分和组成解决方案组件如何在Oracle云实例上运行。甲骨文云在其强大且可扩展的**甲骨文云基础设施** ( **OCI** )可用性域的基础上捆绑了OBP服务和解决方案。整个云设备通过集成的甲骨文**身份云服务** ( **IDCS** )得到保护；

![](assets/0d7f43e6-e523-4d5d-89e3-69243cf60b55.png)

部署架构[Oracle映像]

# 文件存储–推荐OBP采用的方法

像我们的用例一样，许多与当今企业业务流程相关的场景都涉及到文档对象的交换。就实用性而言，在许多情况下，文档本身只是物理过程的直接采用。它主要提供了交易涉众手中的可信物理资产的概念。从技术上讲，它是与业务交易相关的数据值的逻辑分组，如商定的条款和条件、合同以及交易数据。

有了基于区块链的可信解决方案，比如我们正在OBP上构建的解决方案，我们实际上可以消除对文档对象的许多此类需求。尽管如此，出于实用性的考虑，随着采用的增加，文档可以共存，并可能逐渐消失，变得无关紧要(不一定在所有情况下都是如此)。

目前，可以采用以下方法来存储业务文档以及核心OBP解决方案(分类帐)数据:

*   在OBP分类帐中写入事务处理期间:
    *   生成文档的散列，在分类帐上记录散列(链上)并在链外存储文档
    *   文档的链外存储可以是基于云的Oracle内容和体验服务，也可以是其他Oracle云存储选项，如对象存储或文件存储
    *   哈希逻辑应得到交易利益相关方的同意，并且必须得到适当的保护
    *   在智能合约之外执行散列和文档存储操作将减少其执行时间
*   在读取事务期间(即，获取文档资产时):
    *   从选择的文档存储中获取文档。
    *   获取文档的哈希，并将其发送到智能合约进行比较和验证。
    *   在肯定匹配的情况下，可以读取文档。否则，应报告意外情况。

有关这方面的更多详细信息，请参考上一章的文档存储部分。

到目前为止，我们已经走过了业务场景并定义了用例。我们已经分析了用例，通过遍历用例限定来证明对区块链解决方案的需求。一旦我们决定用例符合区块链解决方案的条件，我们就开始设计基于区块链的解决方案。本章的下半部分集中于探索OBP及其体系结构，并建立一个OBP网络实例。

# 探索OBP

正如我们已经知道的，OBP是基于开源的Hyperledger结构。但是对于企业来说，织物是不够的，因为它不是预先组装的。以下是从头开始为企业构建有效的区块链网络的一些高级要求:

*   设置所有的先决条件、配置和容器。
*   设置容器生命周期管理，以管理对等体、通道、链代码等的所有容器。
*   安装安全性，如用户管理，这是企业最重要的组件之一。
*   管理系统升级计划和补丁，以适应快速变化。由于Hyperledger Fabric是开源的，技术将会不断发展，因此您需要不断管理系统升级计划和补丁。
*   确保所有资源的高可用性和可扩展性。
*   为数据提供安全性，并提供集成端点(如REST APIs)来连接其他产品，如SaaS应用程序、ERP或任何第三方应用程序。
*   使用各种工具来监控和处理操作任务，例如检查节点的运行状况和利用率、通道活动、对等活动、通道管理、对等管理、链码管理和网络管理。

要构建一个从基础到生产的区块链网络，您需要技能、资源和时间(可能几个月)来设置和维护所有这些需求。Oracle负责满足所有这些要求，并根据OBP提供服务。在这一节中，我们将深入研究OBP的架构，并学习建立一个OBP实例和区块链网络。

# OBP建筑概述

OBP为构建区块链网络、部署和运行智能合同以及维护分布式账本提供了一个预组装平台。只需点击几下鼠标就可以提供服务，管理员可以使用web控制台动态更新区块链配置并监控其运行。开发人员可以使用REST APIs或客户端SDK部署智能合约和集成应用程序。OBP支持实时分布式P2P交易，并允许应用程序(新的或现有的)通过区块链网络在可信的业务伙伴之间进行交易和共享数据。

请参考https://www.oracle.com/cloud/blockchain/[的](https://www.oracle.com/cloud/blockchain/)，了解OBP产品的最新动态。

因为OBP是Oracle云平台的一部分，所以它预装了底层云服务，包括容器、计算、存储、用于身份验证的身份云服务、用于嵌入式归档的对象存储，以及用于操作和故障排除的管理和日志分析。您可以为可用性、可伸缩性和保密性配置多个对等节点和通道，Oracle Cloud将自动处理底层依赖关系。下图从较高的层面解释了该架构，并解释了OBP如何为开源Hyperledger结构增加价值:

![](assets/03272745-ea05-48c6-aaf1-0238c3b8cb93.png)

OBP高层建筑

OBP是一个许可的区块链，它利用内置的Oracle IDCS到Hyperledger结构来提供以下功能:

*   用户和角色管理
*   对OBP控制台、REST代理和**认证机构** ( **CA** )的认证
*   身份联盟和第三方客户端证书支持，支持联盟形成和简化成员加入

OBP在OCI上运行，是一种PaaS服务。因此，存储、可扩展性、高可用性和基础架构将由Oracle负责。使用Oracle集成云服务的适配器，它可以与Oracle SaaS、PaaS和具有区块链事务、事件和查询的本地应用程序集成。由于OBP基于Hyperledger Fabric，它还允许我们连接使用Hyperledger Fabric的外部成员节点。这些外部成员可以在客户数据中心或第三方云服务中。下图描述了OCI上的OBP服务级别架构:

![](assets/cb931ff9-ace0-4904-bbff-4318f4101440.png)

OBP服务级别架构

Oracle对Hyperledger Fabric进行了许多增强，使OBP成为企业级服务。每个区块链实例包含托管容器、虚拟机、身份管理、块和对象存储以及Oracle Event Hub cloud service，后者是一个专用的Kafka connect。

# blockchain instance区块链结执行处理

一个OBP实例(本书称为区块链实例)是一个容器集合，包括对等节点、订购者、操作控制台、CA、REST代理和链码。OBP实例与身份管理相集成，用于管理用户和角色。它还与Oracle对象存储集成，以动态备份配置更改和分类帐，并在需要时进行恢复。Oracle对象存储备份区块链实例中的所有组件，包括分类帐的所有块文件，还包括系统通道和客户通道中的数据、通道列表、最新检查点、链码的源代码、配置文件以及节点和日志文件的预配文件。此备份和恢复过程将在OBP自动完成，不会通知用户。因此，用户无需担心数据备份。OBP使用甲骨文活动中心云服务作为订购者的专用Kafka。默认REST代理可用于将OBP与任何其他应用程序集成，如SaaS、PaaS、内部部署或其他第三方应用程序。

现在，你应该知道区块链是非常资源密集型的，因为它需要许多有大量存储空间的容器。由于OBP运行在甲骨文云上，服务的存储、可扩展性和高可用性将由甲骨文负责。

OBP有两种方式。一种方法是安装Oracle提供的预构建虚拟机，另一种方法是在Oracle云中创建一个帐户，并从服务组合中调配区块链平台。除了访问和创建区块链实例的初始步骤之外，所有其他功能和导航都是相同的。让我们来看一下OBP资源调配的每一种方式。

# 设置OBP SDK

本节展示了如何在便携式计算机或本地计算机中设置OBP SDK。这只是供参考；然而，也有替代的方法，比如建立在云基础设施上，比如OCI。下面是建立OBP SDK的过程。

# 先决条件

以下是设置OBP SDK的先决条件:

*   Oracle Linux 7.3版或更高版本(OBP运行在任何装有Docker的Linux上，但建议使用Oracle Linux)可上网，Linux内核版本必须高于3.10。
*   磁盘空间取决于计划部署的实例数量。
*   对于应用程序，建议每个实例使用4 GB内存。
*   在供应之后有多个Docker容器在运行，并且每个容器对主机CPU周期的访问应该是无限制的。为了确保每个容器顺利运行，建议至少使用两个CPU。
*   主机名是必需的。
*   需要一个Oracle用户，因为流程运行在Docker容器中(比如peer和orderer)。

从浏览器访问时，主机名应该是可解析的名称。如果在本地设置OBP，主机名必须是虚拟机运行时的名称。在同一个OBP虚拟机中创建多个组织时，主机名将保持不变(即虚拟机名称)，但每个组织的端口范围会有所不同

```
#create user oracle
sudo useradd oracle
sudo passwd oracle
<newPassword>
```

# 准备Docker环境

要构建和安装OBP SDK，需要安装最新的Docker引擎和Docker Compose:

1.  Docker引擎安装:OBP SDK需要最新版本的Docker引擎。执行以下命令，找出Docker引擎版本:

```
docker --version
```

2.  如果版本不是`Docker version 17.05.0-ce`或更高，则按照以下说明安装/更新Docker的最新版本。
3.  使用docker `yum` repo命令，使用以下命令将OS(操作系统)版本替换为您的特定OS版本:

```
$ sudo tee /etc/yum.repos.d/docker.repo <<-EOF 
name=Docker Repository
baseurl=https://yum.dockerproject.org/repo/main/oraclelinux/7
enabled=1
gpgcheck=1
gpgkey=https://yum.dockerproject.org/gpg
EOF
```

4.  安装Docker引擎:

```
$sudo yum install docker-engine-17.05.0.ce
```

5.  检查Docker引擎版本:

```
$docker –version
```

以下截图显示了版本:

![](assets/09829dcf-41cf-4690-9944-fb899de70285.png)

Docker版本

6.  启动Docker引擎:

```
sudo systemctl restart docker
```

7.  向Docker守护程序验证用户:

```
sudo usermod -a -G docker $USER
```

8.  解包部署**区块链云服务** ( **BCS** ) SDK，借助以下代码片段解包:

```
As opc user switch to 
/usr/localcd 
/usr/localsudo 
mkdir bcssdk
cd bcssdk
```

9.  从web或本地资源复制OBP SDK。
10.  通过执行以下命令，将构建包解压缩到`bcssdk`目录:

```
sudo unzip obcs-sdk-19.1.3-20190129043733.zip -d /usr/local/bcssdk
```

本书使用了OBP SDK版本19.1.3，其中Hyperledger Fabric版本为1.3。

11.  现在我们需要安装映像并开始配置控制台。作为 **root** 用户，运行`build`命令加载并安装Docker镜像:

```
./build.sh
```

下面的截图显示了`build.sh`的输出:

![](assets/85a2ba89-150a-44c0-8eca-ebf4371d5fb1.png)

运行build.sh

12.  等到码头装货:

![](assets/c23f73e9-2c61-4458-82b3-e6c62e789335.png)

码头装载量

13.  用`Y`确认，安装完图像后控制台会自动启动:

![](assets/e4910cb2-3b45-4d8f-b5a6-e053c4039490.png)

开始设置

有几点你需要牢记:

*   If the firewall is active, `build.sh` will prompt the user to stop the firewall and restart the Docker daemon.
*   Please use `build.sh` to start setting up the console. If the user does not choose to stop the firewall, there will be problems during or after configuration. Therefore, in this case, we recommend using root.
*   If the firewall is turned off, the user `oracle` already exists, and the non-root user has Docker access, we can use this user to run this command.

# 准备金提取

由于OBP SDK仅用于开发目的，每个配置的实例只能存在60天。一旦过期，该实例将不再工作。如果需要，您需要提供一个新的实例来继续您的测试或原型。

执行以下步骤进行设置:

1.  请使用以下命令行开始设置控制台(如果尚未启动):

```
./build.sh [-d <package directory>, default is current path] [-w provision workspace directory, default ~/obcs_workspace] [-p provision console port, default 3000]
```

2.  将会看到以下消息:

![](assets/ed9283ab-734c-437e-abde-000e4495571f.png)

OBP主控台URL

3.  现在，您可以使用`ssh`和端口转发从本地机器访问控制台。在Linux/mac系统上，打开终端窗口并输入以下内容:

```
ssh -L <localPort>:<remoteIP>:3000 opc@<remoteIP>
```

4.  然后，从您的本地网络浏览器，只需输入`http://localhost:3000`，您应该会看到控制台的用户界面:

![](assets/d859b0f8-7895-4737-83a7-a85575bff194.png)

OBP主控台

# 使用SDK创建区块链实例

使用OBP SDK创建区块链实例的过程如下:

1.  打开虚拟机的登录URL，例如`http://studentvm2:3000/`。
2.  将会打开Oracle登录页面。第一次需要创建用户。
3.  输入**用户名**和**密码**(记住这些凭证以备将来使用)。
4.  点击登录。

5.  如果该用户不存在，将会打开一个标题为“创建用户”的对话框，如下面的屏幕截图所示:

![](assets/8697e65e-719e-45e5-9dcf-c0dde9276a14.png)

OBP SDK登录

6.  单击“确定”创建用户。
7.  创建用户后，将会打开OBP实例页面，如下面的屏幕截图所示。使用此页面可创建实例并列出所有创建的实例:

![](assets/3c28d7bc-ef28-4f55-a68b-9957c84b9d69.png)

OBP SDK主控台

# 在OBP SDK中创建方正实例

要创建创建者实例，请在创建实例部分提供详细信息，并确保选中创建者复选框:

1.  名称:如下图所示，可以设置要创建的实例的名称，例如`detroitauto`。

2.  主机地址:如下面的屏幕截图所示，输入为其设置SDK的虚拟机的主机地址。只能使用此主机地址访问实例。
3.  **Start Port** :参照截图，创建实例后，输入一个端口(或一系列端口)来访问控制台:

![](assets/6292d3fd-f3ca-4800-8cfd-22375986cef0.png)

OBP sdk创始人1

4.  单击 **Create** 按钮，等待一段时间以查看创建的实例，因为必须创建多个容器和虚拟机，并使它们启动和运行。
5.  创建实例后，它将出现在左侧的实例下:

![](assets/40f323d7-7f0a-4cb8-ac38-1d139a3f8d94.png)

OBP SDK创始人

6.  单击实例名称，将打开该实例的区块链控制台。

现在让我们在OBP SDK中创建一个参与者实例。

# 在OBP SDK中创建参与者实例

要创建参与者，请遵循前面的步骤，但取消选中Founder:

1.  查看以下截图，以供参考:

![](assets/3d3d9dcc-2e5c-4fc1-ae3e-21deef7545d1.png)

OBP SDK参与者

2.  点击创建并等待几分钟(在我的例子中，是4分钟)；然后，您将看到一个新的参与者实例已被添加到实例列表中，如下所示:

![](assets/9694ff93-18d6-49bf-adc4-a5285610d012.png)

OBP SDK参与者

参考OBP 部分的*功能和组件，了解OBP控制台的外观并探索其功能。*

# 在Oracle云上调配OBP

在Oracle云中访问OBP的步骤如下:

1.  open[https://cloud . Oracle . com](https://cloud.oracle.com/)。
2.  点按右上角的“登录”。
3.  输入您的**云帐户名**，点击下一步。
4.  输入您的用户名和密码，然后单击登录按钮。
5.  将打开云我的服务页面。

6.  点击左上角的汉堡图标，展开服务菜单。然后你会在列表中看到区块链平台，如下截图所示:

![](assets/bfd23d87-1912-435d-a3fc-3631954fdc4d.png)

OBP云服务

7.  点击区块链平台。它将打开OBP控制台。在这里，您可以创建新的OBP实例或查看在帐户中创建的实例列表。您还可以查看实例活动的历史记录:

![](assets/2f0dd2c0-5aaa-420d-a3fa-279fd489b9e2.png)

OBP云控制台

# 在Oracle云上创建方正实例

如前一节所示，打开OBP控制台后，单击Create Instance:

1.  将会打开“创建实例”页面:

![](assets/993fed13-570c-4c20-85e1-1198cfa23f88.png)

OBP云创始人

2.  如上图所示，在表单中填写详细信息。
3.  确保启用了创建新网络复选框。这在创建创始人时非常重要。

4.  点击下一步。将出现一个页面，显示您提供的详细信息以供确认，如下面的屏幕截图所示:

![](assets/5f709bc2-5f0f-4531-9e39-7df8804fcfcb.png)

OBP云创始人

5.  验证所有详细信息，然后单击创建。
6.  等一会儿。成功创建实例后，将出现以下屏幕。我们将向您提供的电子邮件地址发送一封确认邮件:

![](assets/d3afa668-e905-477b-9ddc-41a4dca87bc4.png)

OBP云创始人

7.  在实例名称旁边，单击汉堡包图标。将显示一个菜单。如果你点击区块链控制台选项，实例的控制台就会打开。

# 在Oracle云上创建参与者实例

要创建参与者，请遵循前面在*在Oracle Cloud* 上创建founder实例一节中提到的步骤，但取消选中创建新网络:

1.  查看以下截图，以供参考:

![](assets/e4538b35-100f-46b1-a15a-2f3890555f23.png)

OBP云参与者

2.  创建参与者实例后，您可以在OBP控制台的instances选项卡上看到实例列表，如下面的屏幕截图所示:

![](assets/23098017-a837-4b11-b60e-661aac218686.png)

OBP云实例

# OBP的特征和组成

在本节中，我们将了解Oracle区块链实例控制台的外观，并研究其功能。如果您使用OBP SDK或通过Oracle Cloud创建区块链实例，OBP实例的控制台将是相同的，如下面的屏幕截图所示:

![](assets/555260f4-f8fc-4688-a05d-22e941d2a9ea.png)

OBP例程控制板

控制台有多个选项卡，我们将在下面的小节中逐一探讨。

# 仪表盘

这是第一个选项卡，显示以下内容的摘要:

*   实例已创建或属于其中的通道数
*   实例正在使用的对等机数量
*   在实例上部署和运行的链代码的数量
*   通道的活动，如创建的块数和通道上的用户事务数
*   对等方的活动，如签署和提交
*   实例的健康状况，例如运行和停止的节点数
*   CPU、内存和磁盘利用率的指标

除了仪表板上的这些数据之外，如果实例是创建者，那么它还会显示参与网络的组织的顺序和数量。

每个区块链网络只有一个订购者，而且是OBP的创始人。

# 网络拓扑结构

此选项卡显示参与网络的每个人。此外，它还显示了网络的拓扑视图:

![](assets/3b1bd386-cdde-4f4d-be7d-a5ffe00b3b57.png)

OBP网络拓扑

上图显示了网络的结构以及组织和节点之间的关系。

# 节点拓扑

该选项卡显示所有对等体，包括自己的对等体和远程对等体，它们都是网络和CA节点的一部分。如果是创建者，它可以看到orderer的一个额外节点。它还显示了网络的节点和对等点的拓扑视图:

![](assets/6130964b-930f-4011-8437-4289e5710a73.png)

OBP节点拓扑

上图显示了对等点和通道之间的关系。

# 通道

此选项卡用于管理实例的通道。它将列出该实例所属的所有通道。也可以从这里创建一个新的通道。可以管理渠道级别的策略，可以将新的对等方添加到渠道中，还可以在渠道中添加或删除组织。每个通道将有自己的分类账，它将显示分类账的所有块和交易。频道一旦创建，就不能删除。

# 链码

此选项卡用于管理链码，并列出实例中所有网络的所有链码。链码的部署、初始化和实例化可以在这里完成。该链码可以写入和更新通道的分类帐。一旦链码被部署，它就不能被更新。链码可以在多个通道中实例化。在通道中，每个版本的每个链码只允许一个链码实例化，这意味着如果在通道中的一个节点上实例化了一个链码，那么通道中的其他节点只需要部署该链码，实例化将自动反映在它们上面。每个链码都有自己的日志和私有数据集合，也可以从该选项卡访问。

# 开发者工具

该选项卡允许我们访问OBP文档，并提供从Oracle下载SDK、工具和预构建示例链代码的链接。

在接下来的章节中，我们将会看到如何创建一个区块链网络并邀请组织加入该网络，创建和部署链码，使用链码，测试分类帐，使用REST代理等等。

# 丰富的OBP历史数据库

OBP使用Hyperledger结构历史数据库来管理分类帐，并在控制台中显示分类帐交易信息。只有链码可以访问这个历史数据库，它不能暴露给任何外部应用程序来查询分析。任何企业都不能忽视分析，即使他们提供区块链服务。因此，OBP集成了丰富的历史数据库来满足这一需求。

丰富的历史数据库位于OBP之外，包含有关区块链分类帐在您选择的渠道上的交易的数据。您可以将丰富的历史数据库集成到OBP实例控制台中，并选择需要在数据库中捕获其数据的通道。一旦在通道上启用了丰富历史数据库，通道上的所有事务都会同步到数据库。这种级别的数据收集使丰富的历史数据库成为生成分类帐活动的分析和可视化报告的优秀数据源。您可以使用任何分析工具，如Oracle Analytics Cloud或Oracle Data Visualization Cloud Service，来访问丰富的历史数据库并创建分析报告或数据可视化。

OBP只支持Oracle数据库，如Oracle自治数据仓库或与OCI合作的 **Oracle数据库云服务** ( **ODCS** )来创建您丰富的历史数据库。

# 创建ODCS连接字符串

OBP可以和OCI的ODCS整合成一个丰富的历史数据库。但是，还必须能够通过端口`1521`访问数据库。

# 获取ODCS信息

在OCI控制台中创建到ODCS的连接的过程如下:

1.  登录甲骨文云，打开我的服务页面。
2.  单击左上角的汉堡包图标，展开服务菜单，然后选择数据库选项。
3.  在DB Systems下，找到要连接的数据库并记录其公共IP地址。
4.  单击数据库的名称，并获取以下字段的值:
    *   数据库唯一名称
    *   主机域名
    *   港口
5.  查找对此数据库具有读取权限的数据库用户的用户名和口令。

# 启用端口1521访问数据库

启用ODCS上的端口`1521`的步骤如下:

1.  如前所示，导航到DB Systems并单击要连接的数据库。
2.  点击虚拟云网络。
3.  在安全列表下，导航到相应的子网。

4.  点击<target database="">的默认安全列表。将显示安全性列表页面。</target>
5.  点击编辑所有规则。
6.  添加入口规则，以允许来自公共互联网的任何传入流量到达此数据库节点上的端口`1521`,设置如下:
    *   来源CIDR: `0.0.0/0`
    *   IP协议:`TCP`
    *   源端口范围:`All`
    *   目的地端口范围:`1521`
    *   允许:端口的TCP流量:`1521`

# 创建连接字符串

启用对Oracle数据库的访问后，使用收集的信息在“配置丰富历史记录”对话框中构建连接字符串。按如下方式构造连接字符串:

```
<publicIP>:<portNumber>/<database unique name>.<host domain name>
```

以下示例显示了连接字符串的样子:

```
123.213.85.123:1521/CustDB_iad1vm.sub05031027070.customervcnwith.oraclevcn.com
```

# 在OBP配置丰富的历史数据库

每个区块链网络实例都可以配置自己的丰富历史数据库，以下是完成此操作的过程:

1.  打开区块链网络实例的控制台。
2.  点击选项按钮(右上角的汉堡包图标)，然后点击配置丰富的历史。将打开一个配置对话框:

![](assets/a77a4ece-9258-4729-b4f0-6cc69f6f4e3e.png)

配置丰富的历史记录

3.  输入要连接的数据库的**用户名**和**密码**。
4.  在连接字符串字段中，输入将存储丰富历史数据的数据库的连接字符串。该输入取决于所使用的Oracle数据库:
    *   如果数据库是Oracle自治仓库，那么连接字符串就像`<username>adw_high`。
    *   如果数据库是OCI的ODCS，按照*创建ODCS连接字符串*一节中的讨论获取连接字符串。
    *   如果您正在使用一个非自治数据库，并且想要使用`sys`用户来连接数据库，那么您必须将`?as=sys[dba|asm|oper]`附加到连接字符串，例如`123.123.123.123:1521/example.oraclevcn.com?as=sysdba`。
    *   如果您使用的是Oracle自治数据库，那么您也可以使用wallet文件来代替连接字符串。该文件包含客户机凭据，由Oracle自治数据库生成。

5.  点击保存按钮。
6.  要更新此配置，请重复相同的过程。

以下截图供大家参考:

![](assets/77bf71f6-e907-4ef2-a69b-cfe5e0f04fdf.png)

配置丰富的历史记录

# 启用将数据写入丰富历史数据库的通道

在通道上启用丰富的历史数据库之前，必须在实例中进行配置。请遵循以下步骤:

1.  打开区块链实例的控制台，并转到Channels选项卡
2.  找到该频道，然后单击更多选项图标
3.  要将频道添加到丰富历史数据库，请单击菜单中的配置丰富历史选项
4.  “配置丰富历史记录”对话框将打开，并带有“启用丰富历史记录”复选框
5.  单击复选框以添加频道，取消选中复选框以删除频道
6.  点击保存按钮

# 丰富的历史数据库表和列

在通道上配置丰富的历史数据库时，将在数据库中为通道创建三个表:历史、状态和最新高度。要创建分析报告，将查询历史和状态表:

![](assets/8ef5bf92-7cbc-4b48-870c-23f3f806e63f.png)

丰富的历史表格

让我们看看每个表及其列。

# 历史表

这个表的名字类似于`<instance name>_<channel name>_hist`。

此表包含渠道分类帐的历史记录。以下是列及其数据类型的列表:

| **栏** | **Datatype** |
| --- | --- |
| `chaincodeId` | `VARCHAR2 (256)` |
| `key` | `VARCHAR2 (1024)` |
| `txnIsValid` | `NUMBER (1)` |
| `value` | `VARCHAR2 (4000)` |
| `valueJson` | `CLOB` |
| `blockNo` | `NUMBER NOT NULL` |
| `txnNo` | `NUMBER NOT NULL` |
| `txnId` | `VARCHAR2 (128)` |
| `txnTimestamp` | `TIMESTAMP` |
| `txnIsDelete` | `NUMBER (1)` |

注意，`value`和`valueJson`列是以互斥的方式使用的。也就是说，当一个键值是有效的JSON时，那么这个值就被设置到`valueJson`列中。否则，在`value`栏中设置该值。`valueJson`列在数据库中被设置为JSON列，这意味着用户可以使用通常的Oracle JSON特定扩展来查询该列。

# 状态表

这个表的名字类似于`<instance name>_<channel name>_state`。

该表复制州数据库中的数据。以下是列及其数据类型的列表:

| **栏** | **Datatype** |
| --- | --- |
| `chaincodeId` | `VARCHAR2 (256)` |
| `key` | `VARCHAR2 (1024)` |
| `value` | `VARCHAR2 (4000)` |
| `valueJson` | `CLOB` |
| `blockNo` | `NUMBER` |
| `txnNo` | `NUMBER` |

与历史表一样，`value`和`valueJson`列以互斥的方式使用。

# 最新高度表

这个表的名字类似于`<instance name>_<channel name>_last`。

OBP内部使用该表来跟踪丰富历史数据库中记录的块高度。无法查询此表进行分析。

当丰富的历史数据库连接到 **SQL Developer** 工具时，这里有一个截图供您参考，以查看这些早期的表格:

![](assets/dec50c32-ce32-464e-993a-702dbb00f8d2.png)

带列的丰富历史表格

# 摘要

企业一直在寻找有效且高效的方法来利用区块链技术及其SaaS、BPM和其他应用。BaaS让他们意识到这一点。这一章提供了对OBP的一瞥。本章的重点是设计一个符合OBP架构的解决方案。本章介绍了示例业务网络拓扑、网络构件以及解决方案和部署架构。本章还深入研究了如何定义和创建一个基于创始人的业务网络实例，并向其中添加参与者。通过本章获得的知识将帮助您在下一章管理区块链网络，并作为开发OBP解决方案的基础里程碑，如前一章所述。下一章将让你深入了解OBP的管理，并教你在OBP上转换网络拓扑。它深入研究了同行、订单和渠道配置。它还提供了关于REST配置和REST接口管理的细节。后续章节将详细介绍OBP，并重点介绍Oracle BaaS平台的强大功能。